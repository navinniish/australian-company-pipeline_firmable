version: 2

sources:
  - name: core
    description: "Core company data tables"
    schema: core
    tables:
      - name: companies
        description: "Main companies table with unified company data"
        columns:
          - name: company_id
            description: "Unique company identifier"
            tests:
              - unique
              - not_null
          - name: abn
            description: "Australian Business Number"
            tests:
              - unique
          - name: company_name
            description: "Primary company name"
            tests:
              - not_null
          - name: normalized_name
            description: "Normalized version of company name for matching"
          - name: data_quality_score
            description: "Data quality score (0.0 to 1.0)"
            tests:
              - dbt_utils.accepted_range:
                  min_value: 0
                  max_value: 1
                  
      - name: company_names
        description: "Alternative company names (trading names, business names)"
        columns:
          - name: company_id
            description: "Reference to companies table"
            tests:
              - not_null
              - relationships:
                  to: source('core', 'companies')
                  field: company_id
          - name: name
            description: "Alternative name"
            tests:
              - not_null
          - name: name_type
            description: "Type of name (trading, business, legal, dba)"
            tests:
              - accepted_values:
                  values: ['trading', 'business', 'legal', 'dba']
                  
      - name: company_contacts
        description: "Company contact information"
        columns:
          - name: company_id
            description: "Reference to companies table"
            tests:
              - not_null
              - relationships:
                  to: source('core', 'companies')
                  field: company_id
          - name: contact_type
            description: "Type of contact"
            tests:
              - accepted_values:
                  values: ['email', 'phone', 'fax', 'linkedin', 'twitter', 'facebook']
          - name: contact_value
            description: "Contact value"
            tests:
              - not_null
              
      - name: industry_classifications
        description: "Industry classification data"
        columns:
          - name: company_id
            description: "Reference to companies table"
            tests:
              - not_null
              - relationships:
                  to: source('core', 'companies')
                  field: company_id
          - name: classification_system
            description: "Classification system used (e.g., ANZSIC)"
          - name: code
            description: "Industry classification code"
          - name: confidence_score
            description: "Confidence in the classification"
            tests:
              - dbt_utils.accepted_range:
                  min_value: 0
                  max_value: 1
                  
      - name: data_lineage
        description: "Data lineage tracking"
        columns:
          - name: company_id
            description: "Reference to companies table"
            tests:
              - not_null
              - relationships:
                  to: source('core', 'companies')
                  field: company_id
          - name: source_system
            description: "Source system (common_crawl, abr)"
            tests:
              - accepted_values:
                  values: ['common_crawl', 'abr']
  
  - name: staging
    description: "Staging tables for raw data"
    schema: staging
    tables:
      - name: common_crawl_raw
        description: "Raw Common Crawl extraction data"
        
      - name: abr_raw
        description: "Raw ABR extraction data"
        
      - name: entity_matching_candidates
        description: "Entity matching results"